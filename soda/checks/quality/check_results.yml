# QUALITY Layer - Check Results Table Quality Checks
# Database: SODA_CERTIFICATION, Schema: QUALITY
# Table: check_results (variable records)
# Purpose: Data quality monitoring results with profiling

# Soda Cloud Profiling Configuration for Partner Certification
profile columns:
  columns:
    - CHECK_RESULTS.%
    - exclude CHECK_RESULTS.CHECK_TIMESTAMP
    - exclude CHECK_RESULTS.CREATED_AT
    - exclude CHECK_RESULTS.UPDATED_AT
    - exclude CHECK_RESULTS.EXECUTION_TIME_MS
    - exclude CHECK_RESULTS.ROWS_CHECKED
    - exclude CHECK_RESULTS.ROWS_FAILED

sample datasets:
  datasets:
    - include CHECK_RESULTS

checks for CHECK_RESULTS:
  # Schema validation
  - schema:
      name: "Quality check results schema validation"
      fail:
        when required column missing: [CHECK_ID, TABLE_NAME, CHECK_STATUS, CHECK_TYPE, CHECK_TIMESTAMP]
        when forbidden column present: [DUPLICATE_CHECK_ID, TEST_COLUMN]

  # Completeness checks (safe on empty tables) with sampling
  - missing_count(CHECK_ID) = 0:
      name: "No missing check IDs"
      samples limit: 1000

  - missing_count(TABLE_NAME) = 0:
      name: "No missing table names"
      samples limit: 1000

  - missing_count(CHECK_STATUS) = 0:
      name: "No missing check statuses"
      samples limit: 1000

  - missing_count(CHECK_TIMESTAMP) = 0:
      name: "No missing check timestamps"
      samples limit: 1000

  # Validity checks with sampling
  - invalid_count(CHECK_STATUS) = 0:
      name: "All check statuses are valid"
      valid values: ['pass', 'fail', 'warn', 'error']
      samples limit: 1000

  - invalid_count(CHECK_TYPE) = 0:
      name: "All check types are valid"
      valid values: ['row_count', 'missing_count', 'duplicate_count', 'invalid_count', 'freshness', 'schema']
      samples limit: 1000

  # Freshness and row_count checks omitted to avoid failures on empty table during initial runs
